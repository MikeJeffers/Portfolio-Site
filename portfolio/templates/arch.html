{%extends "base.html"%}
{%block nav%}
{%include 'nav.html'%}
{%endblock%}

{%block content%}
<div class="row">
	<div class = "col-xs-12 text-center">
    {%for i in years %}
    <button type="button" class = "btn btn-secondary btn-lg" onclick="getYear({{i}})">Year{{i}}</button>
    {%endfor%}
    <br><br>

	</div>
</div>
<div class="row">
	<div class = "col-xs-12 text-center">

		<div id="masonry-grid">
    	<div class="grid-sizer">
    		
    	</div>
   		</div>

	</div>
</div>

<script type="text/javascript">
    var $container=$('#masonry-grid');
    $container.masonry({
      itemSelector:'.grid-item',
      percentPosition:true,
      columnWidth:'.grid-sizer',
      animate:true
    });
    $container.imagesLoaded().progress(function(){
      $container.masonry();
    });
    $container.on('click','.grid-item',function(){
        var $target = $(this);
        var w = $target.width();
        var windowWidth = $container.width();
        var fifth = (windowWidth/5);

        $target.toggleClass('.grid-item--width2');
        if(w>fifth+1){
          w=fifth;
        }else{
          w=fifth*2;
        }
        $(this).children().animate({width:w});
        $(this).animate({width:w},doMasonry);
    });


      //getAllImgs();
      function getAllImgs(){
        $.get("{% url 'get-all-projects' %}", onSuccess);
      }
      function getYear(year){
        $( ".grid-item" ).remove();
        console.log(year);
        var url = '{% url "get-projects-by-year" 0 %}'.replace (0, year);
        $.get(url,onSuccess);
      }
      function onSuccess(data){
        var windowWidth = $container.width();
        var fifth = (windowWidth/5);
        for(var i=0; i<data.imageDict.length; i++){
            var domElement='<div class="grid-item"><img width="'+fifth+'"src="'+data.imageDict[i]+'"/></div>';
            var $wrap=$(domElement);
            $container.append($wrap).masonry('appended',$wrap).masonry();
          }
          doMasonry();
      }


      function doMasonry(){
        $container.imagesLoaded().progress(function(){
          $container.masonry();
        });
      }
      window.onresize = doMasonry;
</script>

{%endblock%}
